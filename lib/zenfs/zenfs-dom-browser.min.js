"use strict";var ZenFS_DOM=(()=>{var g=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var U=Object.getOwnPropertyNames;var W=Object.prototype.hasOwnProperty;var c=(e,t)=>g(e,"name",{value:t,configurable:!0});var Y=(e,t)=>{for(var i in t)g(e,i,{get:t[i],enumerable:!0})},G=(e,t,i,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of U(t))!W.call(e,o)&&o!==i&&g(e,o,{get:()=>t[o],enumerable:!(n=H(t,o))||n.enumerable});return e};var K=e=>G(g({},"__esModule",{value:!0}),e);var Z={};Y(Z,{IndexedDB:()=>j,IndexedDBStore:()=>I,IndexedDBTransaction:()=>h,WebAccess:()=>q,WebAccessFS:()=>p,WebStorage:()=>L,WebStorageStore:()=>T});var ee=ZenFS,{Async:x,AsyncTransaction:te,BigIntStats:ie,BigIntStatsFs:se,Dir:ne,Dirent:oe,Errno:E,ErrnoError:l,Fetch:re,FetchFS:ae,File:ce,FileSystem:P,FileType:le,InMemory:D,InMemoryStore:de,IndexFS:Se,Inode:Ee,LockedFS:ue,Mutex:me,NoSyncFile:fe,Overlay:Oe,OverlayFS:ye,Port:pe,PortFS:Ne,PortFile:he,PreloadFile:M,ReadStream:Ie,Readonly:Te,SimpleAsyncStore:ge,SimpleTransaction:v,Stats:b,StatsCommon:xe,StatsFs:De,StoreFS:F,Sync:be,SyncTransaction:Fe,Transaction:Re,UnlockedOverlayFS:we,WriteStream:Ae,ZenFsType:Pe,_toUnixTimestamp:Me,access:ve,accessSync:_e,appendFile:Ce,appendFileSync:ke,attachFS:Be,checkOptions:Le,chmod:He,chmodSync:Ue,chown:We,chownSync:Ye,close:Ge,closeSync:Ke,configure:Xe,constants:ze,copyFile:Ve,copyFileSync:$e,cp:qe,cpSync:Qe,createReadStream:je,createWriteStream:Ze,decode:_,decodeDirListing:Je,detachFS:et,encode:C,encodeDirListing:tt,errorMessages:it,exists:st,existsSync:nt,fchmod:ot,fchmodSync:rt,fchown:at,fchownSync:ct,fdatasync:lt,fdatasyncSync:dt,flagToMode:St,flagToNumber:Et,flagToString:ut,fs:mt,fstat:ft,fstatSync:Ot,fsync:yt,fsyncSync:pt,ftruncate:Nt,ftruncateSync:ht,futimes:It,futimesSync:Tt,isAppendable:gt,isBackend:xt,isBackendConfig:Dt,isExclusive:bt,isReadable:Ft,isSynchronous:Rt,isTruncating:wt,isWriteable:At,lchmod:Pt,lchmodSync:Mt,lchown:vt,lchownSync:_t,levenshtein:Ct,link:kt,linkSync:Bt,lopenSync:Lt,lstat:Ht,lstatSync:Ut,lutimes:Wt,lutimesSync:Yt,mkdir:Gt,mkdirSync:Kt,mkdirpSync:Xt,mkdtemp:zt,mkdtempSync:Vt,mount:$t,mountObject:qt,mounts:Qt,nop:jt,normalizeMode:Zt,normalizeOptions:Jt,normalizePath:ei,normalizeTime:ti,open:ii,openAsBlob:si,openSync:ni,opendir:oi,opendirSync:ri,parseFlag:ai,promises:ci,randomIno:li,read:di,readFile:Si,readFileSync:Ei,readSync:ui,readdir:mi,readdirSync:fi,readlink:Oi,readlinkSync:yi,readv:pi,readvSync:Ni,realpath:hi,realpathSync:Ii,rename:Ti,renameSync:gi,resolveMountConfig:xi,rm:Di,rmSync:bi,rmdir:Fi,rmdirSync:Ri,rootCred:wi,rootIno:Ai,setImmediate:Pi,size_max:Mi,stat:vi,statSync:_i,statfs:Ci,statfsSync:ki,symlink:Bi,symlinkSync:Li,truncate:Hi,truncateSync:Ui,umount:Wi,unlink:Yi,unlinkSync:Gi,unwatchFile:Ki,utimes:Xi,utimesSync:zi,watch:Vi,watchFile:$i,write:qi,writeFile:Qi,writeFileSync:ji,writeSync:Zi,writev:Ji,writevSync:es}=ZenFS;function X(e,t){let i="",n=0,o=-1,r=0,d="\0";for(let a=0;a<=e.length;++a){if(a<e.length)d=e[a];else{if(d=="/")break;d="/"}if(d=="/"){if(!(o===a-1||r===1))if(r===2){if(i.length<2||n!==2||i.at(-1)!=="."||i.at(-2)!=="."){if(i.length>2){let f=i.lastIndexOf("/");f===-1?(i="",n=0):(i=i.slice(0,f),n=i.length-1-i.lastIndexOf("/")),o=a,r=0;continue}else if(i.length!==0){i="",n=0,o=a,r=0;continue}}t&&(i+=i.length>0?"/..":"..",n=2)}else i.length>0?i+="/"+e.slice(o+1,a):i=e.slice(o+1,a),n=a-o-1;o=a,r=0}else d==="."&&r!==-1?++r:r=-1}return i}c(X,"normalizeString");function z(e){if(!e.length)return".";let t=e.startsWith("/"),i=e.endsWith("/");return e=X(e,!t),e.length?(i&&(e+="/"),t?`/${e}`:e):t?"/":i?"./":"."}c(z,"normalize");function R(...e){if(!e.length)return".";let t=e.join("/");return t?.length?z(t):"."}c(R,"join");function O(e){if(e.length===0)return".";let t=e[0]==="/",i=-1,n=!0;for(let o=e.length-1;o>=1;--o)if(e[o]==="/"){if(!n){i=o;break}}else n=!1;return i===-1?t?"/":".":t&&i===1?"//":e.slice(0,i)}c(O,"dirname");function y(e,t){let i=0,n=-1,o=!0;if(t!==void 0&&t.length>0&&t.length<=e.length){if(t===e)return"";let r=t.length-1,d=-1;for(let a=e.length-1;a>=0;--a)if(e[a]==="/"){if(!o){i=a+1;break}}else d===-1&&(o=!1,d=a+1),r>=0&&(e[a]===t[r]?--r===-1&&(n=a):(r=-1,n=d));return i===n?n=d:n===-1&&(n=e.length),e.slice(i,n)}for(let r=e.length-1;r>=0;--r)if(e[r]==="/"){if(!o){i=r+1;break}}else n===-1&&(o=!1,n=r+1);return n===-1?"":e.slice(i,n)}c(y,"basename");function V(e){switch(e.name){case"IndexSizeError":case"HierarchyRequestError":case"InvalidCharacterError":case"InvalidStateError":case"SyntaxError":case"NamespaceError":case"TypeMismatchError":case"ConstraintError":case"VersionError":case"URLMismatchError":case"InvalidNodeTypeError":return"EINVAL";case"WrongDocumentError":return"EXDEV";case"NoModificationAllowedError":case"InvalidModificationError":case"InvalidAccessError":case"SecurityError":case"NotAllowedError":return"EACCES";case"NotFoundError":return"ENOENT";case"NotSupportedError":return"ENOTSUP";case"InUseAttributeError":return"EBUSY";case"NetworkError":return"ENETDOWN";case"AbortError":return"EINTR";case"QuotaExceededError":return"ENOSPC";case"TimeoutError":return"ETIMEDOUT";case"ReadOnlyError":return"EROFS";case"DataCloneError":case"EncodingError":case"NotReadableError":case"DataError":case"TransactionInactiveError":case"OperationError":case"UnknownError":default:return"EIO"}}c(V,"errnoForDOMException");function u(e,t,i){if(e instanceof l)return e;let n=e instanceof DOMException?E[V(e)]:E.EIO,o=new l(n,e.message,t,i);return o.stack=e.stack,o.cause=e.cause,o}c(u,"convertException");var p=class extends x(P){_handles=new Map;_sync=D.create({name:"accessfs-cache"});constructor(t){super(),this._handles.set("/",t)}metadata(){return{...super.metadata(),name:"WebAccess",noResizableBuffers:!0}}async sync(t,i,n){let o=await this.stat(t);n.mtime!==o.mtime&&await this.writeFile(t,i)}async rename(t,i){try{let n=await this.getHandle(t);if(n instanceof FileSystemDirectoryHandle){let f=await this.readdir(t);if(await this.mkdir(i),f.length==0)await this.unlink(t);else for(let A of f)await this.rename(R(t,A),R(i,A)),await this.unlink(t)}if(!(n instanceof FileSystemFileHandle))return;let o=await n.getFile(),r=await this.getHandle(O(i));if(!(r instanceof FileSystemDirectoryHandle))return;let a=await(await r.getFileHandle(y(i),{create:!0})).createWritable();await a.write(await o.arrayBuffer()),a.close(),await this.unlink(t)}catch(n){throw u(n,t,"rename")}}async writeFile(t,i){if(i.buffer.resizable)throw new l(E.EINVAL,"Resizable buffers can not be written",t,"write");let n=await this.getHandle(O(t));if(!(n instanceof FileSystemDirectoryHandle))return;let r=await(await n.getFileHandle(y(t),{create:!0})).createWritable();await r.write(i),await r.close()}async createFile(t,i){return await this.writeFile(t,new Uint8Array),this.openFile(t,i)}async stat(t){let i=await this.getHandle(t);if(!i)throw l.With("ENOENT",t,"stat");if(i instanceof FileSystemDirectoryHandle)return new b({mode:16895,size:4096});if(i instanceof FileSystemFileHandle){let{lastModified:n,size:o}=await i.getFile();return new b({mode:33279,size:o,mtimeMs:n})}throw new l(E.EBADE,"Handle is not a directory or file",t,"stat")}async openFile(t,i){let n=await this.getHandle(t);if(!(n instanceof FileSystemFileHandle))throw l.With("EISDIR",t,"openFile");try{let o=await n.getFile(),r=new Uint8Array(await o.arrayBuffer()),d=new b({mode:33279,size:o.size,mtimeMs:o.lastModified});return new M(this,t,i,d,r)}catch(o){throw u(o,t,"openFile")}}async unlink(t){let i=await this.getHandle(O(t));if(i instanceof FileSystemDirectoryHandle)try{await i.removeEntry(y(t),{recursive:!0})}catch(n){throw u(n,t,"unlink")}}async link(t){throw l.With("ENOSYS",t,"WebAccessFS.link")}async rmdir(t){return this.unlink(t)}async mkdir(t){if(await this.getHandle(t))throw l.With("EEXIST",t,"mkdir");let n=await this.getHandle(O(t));if(!(n instanceof FileSystemDirectoryHandle))throw l.With("ENOTDIR",t,"mkdir");await n.getDirectoryHandle(y(t),{create:!0})}async readdir(t){let i=await this.getHandle(t);if(!(i instanceof FileSystemDirectoryHandle))throw l.With("ENOTDIR",t,"readdir");let n=[];for await(let o of i.keys())n.push(o);return n}async getHandle(t){if(this._handles.has(t))return this._handles.get(t);let i="/";for(let n of t.split("/").slice(1)){let o=this._handles.get(i);if(!(o instanceof FileSystemDirectoryHandle))throw l.With("ENOTDIR",i,"getHandle");i=R(i,n);try{let r=await o.getDirectoryHandle(n);this._handles.set(i,r)}catch(r){let d=r;if(d.name=="TypeMismatchError")try{let a=await o.getFileHandle(n);this._handles.set(i,a)}catch(a){u(a,i,"getHandle")}if(d.name==="TypeError")throw new l(E.ENOENT,d.message,i,"getHandle");u(d,i,"getHandle")}}return this._handles.get(t)}};c(p,"WebAccessFS");var q={name:"WebAccess",options:{handle:{type:"object",required:!0,description:"The directory handle to use for the root"}},isAvailable(){return typeof FileSystemHandle=="function"},create(e){return new p(e.handle)}};var s;(function(e){e[e.EPERM=1]="EPERM",e[e.ENOENT=2]="ENOENT",e[e.EINTR=4]="EINTR",e[e.EIO=5]="EIO",e[e.ENXIO=6]="ENXIO",e[e.EBADF=9]="EBADF",e[e.EAGAIN=11]="EAGAIN",e[e.ENOMEM=12]="ENOMEM",e[e.EACCES=13]="EACCES",e[e.EFAULT=14]="EFAULT",e[e.ENOTBLK=15]="ENOTBLK",e[e.EBUSY=16]="EBUSY",e[e.EEXIST=17]="EEXIST",e[e.EXDEV=18]="EXDEV",e[e.ENODEV=19]="ENODEV",e[e.ENOTDIR=20]="ENOTDIR",e[e.EISDIR=21]="EISDIR",e[e.EINVAL=22]="EINVAL",e[e.ENFILE=23]="ENFILE",e[e.EMFILE=24]="EMFILE",e[e.ETXTBSY=26]="ETXTBSY",e[e.EFBIG=27]="EFBIG",e[e.ENOSPC=28]="ENOSPC",e[e.ESPIPE=29]="ESPIPE",e[e.EROFS=30]="EROFS",e[e.EMLINK=31]="EMLINK",e[e.EPIPE=32]="EPIPE",e[e.EDOM=33]="EDOM",e[e.ERANGE=34]="ERANGE",e[e.EDEADLK=35]="EDEADLK",e[e.ENAMETOOLONG=36]="ENAMETOOLONG",e[e.ENOLCK=37]="ENOLCK",e[e.ENOSYS=38]="ENOSYS",e[e.ENOTEMPTY=39]="ENOTEMPTY",e[e.ELOOP=40]="ELOOP",e[e.ENOMSG=42]="ENOMSG",e[e.EBADE=52]="EBADE",e[e.EBADR=53]="EBADR",e[e.EXFULL=54]="EXFULL",e[e.ENOANO=55]="ENOANO",e[e.EBADRQC=56]="EBADRQC",e[e.ENOSTR=60]="ENOSTR",e[e.ENODATA=61]="ENODATA",e[e.ETIME=62]="ETIME",e[e.ENOSR=63]="ENOSR",e[e.ENONET=64]="ENONET",e[e.EREMOTE=66]="EREMOTE",e[e.ENOLINK=67]="ENOLINK",e[e.ECOMM=70]="ECOMM",e[e.EPROTO=71]="EPROTO",e[e.EBADMSG=74]="EBADMSG",e[e.EOVERFLOW=75]="EOVERFLOW",e[e.EBADFD=77]="EBADFD",e[e.ESTRPIPE=86]="ESTRPIPE",e[e.ENOTSOCK=88]="ENOTSOCK",e[e.EDESTADDRREQ=89]="EDESTADDRREQ",e[e.EMSGSIZE=90]="EMSGSIZE",e[e.EPROTOTYPE=91]="EPROTOTYPE",e[e.ENOPROTOOPT=92]="ENOPROTOOPT",e[e.EPROTONOSUPPORT=93]="EPROTONOSUPPORT",e[e.ESOCKTNOSUPPORT=94]="ESOCKTNOSUPPORT",e[e.ENOTSUP=95]="ENOTSUP",e[e.ENETDOWN=100]="ENETDOWN",e[e.ENETUNREACH=101]="ENETUNREACH",e[e.ENETRESET=102]="ENETRESET",e[e.ETIMEDOUT=110]="ETIMEDOUT",e[e.ECONNREFUSED=111]="ECONNREFUSED",e[e.EHOSTDOWN=112]="EHOSTDOWN",e[e.EHOSTUNREACH=113]="EHOSTUNREACH",e[e.EALREADY=114]="EALREADY",e[e.EINPROGRESS=115]="EINPROGRESS",e[e.ESTALE=116]="ESTALE",e[e.EREMOTEIO=121]="EREMOTEIO",e[e.EDQUOT=122]="EDQUOT"})(s||(s={}));var B={[s.EPERM]:"Operation not permitted",[s.ENOENT]:"No such file or directory",[s.EINTR]:"Interrupted system call",[s.EIO]:"Input/output error",[s.ENXIO]:"No such device or address",[s.EBADF]:"Bad file descriptor",[s.EAGAIN]:"Resource temporarily unavailable",[s.ENOMEM]:"Cannot allocate memory",[s.EACCES]:"Permission denied",[s.EFAULT]:"Bad address",[s.ENOTBLK]:"Block device required",[s.EBUSY]:"Resource busy or locked",[s.EEXIST]:"File exists",[s.EXDEV]:"Invalid cross-device link",[s.ENODEV]:"No such device",[s.ENOTDIR]:"File is not a directory",[s.EISDIR]:"File is a directory",[s.EINVAL]:"Invalid argument",[s.ENFILE]:"Too many open files in system",[s.EMFILE]:"Too many open files",[s.ETXTBSY]:"Text file busy",[s.EFBIG]:"File is too big",[s.ENOSPC]:"No space left on disk",[s.ESPIPE]:"Illegal seek",[s.EROFS]:"Cannot modify a read-only file system",[s.EMLINK]:"Too many links",[s.EPIPE]:"Broken pipe",[s.EDOM]:"Numerical argument out of domain",[s.ERANGE]:"Numerical result out of range",[s.EDEADLK]:"Resource deadlock would occur",[s.ENAMETOOLONG]:"File name too long",[s.ENOLCK]:"No locks available",[s.ENOSYS]:"Function not implemented",[s.ENOTEMPTY]:"Directory is not empty",[s.ELOOP]:"Too many levels of symbolic links",[s.ENOMSG]:"No message of desired type",[s.EBADE]:"Invalid exchange",[s.EBADR]:"Invalid request descriptor",[s.EXFULL]:"Exchange full",[s.ENOANO]:"No anode",[s.EBADRQC]:"Invalid request code",[s.ENOSTR]:"Device not a stream",[s.ENODATA]:"No data available",[s.ETIME]:"Timer expired",[s.ENOSR]:"Out of streams resources",[s.ENONET]:"Machine is not on the network",[s.EREMOTE]:"Object is remote",[s.ENOLINK]:"Link has been severed",[s.ECOMM]:"Communication error on send",[s.EPROTO]:"Protocol error",[s.EBADMSG]:"Bad message",[s.EOVERFLOW]:"Value too large for defined data type",[s.EBADFD]:"File descriptor in bad state",[s.ESTRPIPE]:"Streams pipe error",[s.ENOTSOCK]:"Socket operation on non-socket",[s.EDESTADDRREQ]:"Destination address required",[s.EMSGSIZE]:"Message too long",[s.EPROTOTYPE]:"Protocol wrong type for socket",[s.ENOPROTOOPT]:"Protocol not available",[s.EPROTONOSUPPORT]:"Protocol not supported",[s.ESOCKTNOSUPPORT]:"Socket type not supported",[s.ENOTSUP]:"Operation is not supported",[s.ENETDOWN]:"Network is down",[s.ENETUNREACH]:"Network is unreachable",[s.ENETRESET]:"Network dropped connection on reset",[s.ETIMEDOUT]:"Connection timed out",[s.ECONNREFUSED]:"Connection refused",[s.EHOSTDOWN]:"Host is down",[s.EHOSTUNREACH]:"No route to host",[s.EALREADY]:"Operation already in progress",[s.EINPROGRESS]:"Operation now in progress",[s.ESTALE]:"Stale file handle",[s.EREMOTEIO]:"Remote I/O error",[s.EDQUOT]:"Disk quota exceeded"},S=class extends Error{static fromJSON(t){let i=new S(t.errno,t.message,t.path,t.syscall);return i.code=t.code,i.stack=t.stack,i}static With(t,i,n){return new S(s[t],B[s[t]],i,n)}constructor(t,i=B[t],n,o=""){super(i),this.errno=t,this.path=n,this.syscall=o,this.code=s[t],this.message=`${this.code}: ${i}${this.path?`, '${this.path}'`:""}`}toString(){return this.message}toJSON(){return{errno:this.errno,code:this.code,path:this.path,stack:this.stack,message:this.message,syscall:this.syscall}}bufferSize(){return 4+JSON.stringify(this.toJSON()).length}};c(S,"ErrnoError");var w=class{constructor(t){this.store=t,this.aborted=!1}async[Symbol.asyncDispose](){this.aborted||await this.commit()}[Symbol.dispose](){this.aborted||this.commitSync()}};c(w,"Transaction");var N=class extends w{getSync(){throw S.With("ENOSYS",void 0,"AsyncTransaction.getSync")}setSync(){throw S.With("ENOSYS",void 0,"AsyncTransaction.setSync")}removeSync(){throw S.With("ENOSYS",void 0,"AsyncTransaction.removeSync")}commitSync(){throw S.With("ENOSYS",void 0,"AsyncTransaction.commitSync")}abortSync(){throw S.With("ENOSYS",void 0,"AsyncTransaction.abortSync")}};c(N,"AsyncTransaction");function m(e){return new Promise((t,i)=>{e.onsuccess=()=>t(e.result),e.onerror=n=>{n.preventDefault(),i(u(e.error))}})}c(m,"wrap");var h=class extends N{constructor(i,n){super(n);this.tx=i;this.store=n;this._idb=i.objectStore(n.name)}_idb;get(i){return m(this._idb.get(i.toString()))}async set(i,n){await m(this._idb.put(n,i.toString()))}remove(i){return m(this._idb.delete(i.toString()))}async commit(){this.tx.commit()}async abort(){try{this.tx.abort()}catch(i){throw u(i)}}};c(h,"IndexedDBTransaction");async function Q(e,t=globalThis.indexedDB){let i=t.open(e);return i.onupgradeneeded=()=>{let o=i.result;o.objectStoreNames.contains(e)&&o.deleteObjectStore(e),o.createObjectStore(e)},await m(i)}c(Q,"createDB");var I=class{constructor(t){this.db=t}sync(){throw new Error("Method not implemented.")}get name(){return this.db.name}clear(){return m(this.db.transaction(this.name,"readwrite").objectStore(this.name).clear())}clearSync(){throw l.With("ENOSYS",void 0,"IndexedDBStore.clearSync")}transaction(){let t=this.db.transaction(this.name,"readwrite");return new h(t,this)}};c(I,"IndexedDBStore");var j={name:"IndexedDB",options:{storeName:{type:"string",required:!1,description:"The name of this file system. You can have multiple IndexedDB file systems operating at once, but each must have a different name."},idbFactory:{type:"object",required:!1,description:"The IDBFactory to use. Defaults to globalThis.indexedDB."}},async isAvailable(e=globalThis.indexedDB){try{if(!(e instanceof IDBFactory))return!1;let t=e.open("__zenfs_test");return await m(t),e.deleteDatabase("__zenfs_test"),!0}catch{return e.deleteDatabase("__zenfs_test"),!1}},async create(e){let t=await Q(e.storeName||"zenfs",e.idbFactory),i=new I(t),n=new(x(F))(i);return e?.disableAsyncCache||(n._sync=D.create({name:"idb-cache"})),n}};var T=class{constructor(t){this._storage=t}get name(){return L.name}clear(){this._storage.clear()}clearSync(){this._storage.clear()}async sync(){}transaction(){return new v(this)}get(t){let i=this._storage.getItem(t.toString());if(typeof i=="string")return C(i)}set(t,i){try{this._storage.setItem(t.toString(),_(i))}catch{throw new l(E.ENOSPC,"Storage is full.")}}delete(t){try{this._storage.removeItem(t.toString())}catch(i){throw new l(E.EIO,"Unable to delete key "+t+": "+i)}}};c(T,"WebStorageStore");var L={name:"WebStorage",options:{storage:{type:"object",required:!1,description:"The Storage to use. Defaults to globalThis.localStorage."}},isAvailable(e=globalThis.localStorage){return e instanceof globalThis.Storage},create({storage:e=globalThis.localStorage}){return new F(new T(e))}};return K(Z);})();
//# sourceMappingURL=zenfs-dom-browser.min.js.map
